<template>
<!-- 侧边栏 -->
<header class="header js-header">
  <div class="header__inner">
    <div class="header__onbg">
      <div class="headerNavWrap">
        <div class="headerNavWrap__in">
          <nav class="headerNav">
            <ul class="headerNavLists">
              <li class="headerNavLists__item nav-ani">
                <a href="./" class="headerNavLists__link is-current" data-menu="1">
                  <span class="headerNavLists__text u-font-futura">TOP</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./news/" class="headerNavLists__link" data-menu="2">
                  <span class="headerNavLists__text u-font-futura">NEWS</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./theater/" class="headerNavLists__link" data-menu="3">
                  <span class="headerNavLists__text u-font-futura">THEATER</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./event/" class="headerNavLists__link" data-menu="4">
                  <span class="headerNavLists__text u-font-futura">EVENT</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./staffcast/" class="headerNavLists__link" data-menu="5">
                  <span class="headerNavLists__text u-font-futura">STAFF&CAST</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./story/" class="headerNavLists__link" data-menu="6">
                  <span class="headerNavLists__text u-font-futura">STORY</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./character/" class="headerNavLists__link" data-menu="7">
                  <span class="headerNavLists__text u-font-futura">CHARACTER</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./mecha/" class="headerNavLists__link" data-menu="8">
                  <span class="headerNavLists__text u-font-futura">MECHA</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./keywords/" class="headerNavLists__link" data-menu="9">
                  <span class="headerNavLists__text u-font-futura">KEYWORDS</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./music/" class="headerNavLists__link" data-menu="10">
                  <span class="headerNavLists__text u-font-futura">MUSIC</span>
                </a>
              </li>
              <li class="headerNavLists__item nav-ani">
                <a href="./gallery/" class="headerNavLists__link" data-menu="11">
                  <span class="headerNavLists__text u-font-futura">GALLERY</span>
                </a>
              </li>
            </ul>
  <div class="headerShare">
    <dl class="header__shareDl">
      <dt class="header__shareDl--dt u-font-futura">SHARE</dt>
      <dd class="header__shareDl--dd">
        <ul class="header__shareLists">
          <li class="header__shareLists--item is-twitter"><a href="https://twitter.com/share?url=https://gundam-seed.net/freedom/&text=ガンダムSEEDシリーズ最新作！【2024.1.26公開】劇場版『機動戦士ガンダムSEED%20FREEDOM』公式サイト！最新情報はここでチェック！&hashtags=SEEDFREEDOM,ガンダムSEED,g_seed" onclick="window.open(encodeURI(decodeURI(this.href)), 'tweetwindow', 'width=650, height=470, personalbar=0, toolbar=0, scrollbars=1, sizable=1'); return false;" rel="nofollow" class="is-fade-skip"><span class="hd">Twitter share</span></a></li>
          <li class="header__shareLists--item is-facebook"><a href="https://www.facebook.com/share.php?u=https://gundam-seed.net/freedom/" onclick="window.open(this.href, 'FBwindow', 'width=650, height=450, menubar=no, toolbar=no, scrollbars=yes'); return false;" class="is-fade-skip"><span class="hd">Facebook share</span></a></li>
          <li class="header__shareLists--item is-line"><a href="https://line.me/R/msg/text/?ガンダムSEEDシリーズ最新作！【2024.1.26公開】劇場版『機動戦士ガンダムSEED%20FREEDOM』公式サイト！最新情報はここでチェック！ https://gundam-seed.net/freedom/" onclick="window.open(encodeURI(decodeURI(this.href)), 'linewindow', 'width=550, height=520,personalbar=0,toolbar=0,scrollbars=1,resizable=1'); return false;" target="_blank" class="is-fade-skip"><span class="hd">LINE share</span></a></li>
        </ul>
      </dd>
    </dl>
  </div>
</nav>
</div>
</div>
<!-- /.headerNavWrap -->

<div class="header__triangle"></div>
<!-- 选项白色背景 -->
</div>
</div><!-- /.header__inner -->

  <!-- 右侧菜单栏 -->
  <div class="header__openInner">
    <div class="header__navBtnWrap">
      <!-- Menu -->
      <a href="javascript:;" class="header__navBtn js-menu">
        <div class="header__navBtn__lineWrap">
          <span class="header__navBtn--line"></span>
          <span class="header__navBtn--line"></span>
        </div>
      </a>
    </div><!-- /.header__navBtn -->
    <div class="header__sns">
      <p class="header__sns--title"><span class="u-font-futura">OFFICIAL</span></p>
      <ul class="header__sns--list">
        <li class="header__sns--item"><a href="https://twitter.com/SEED_HDRP" class="icon-tw" target="_blank"><span class="hd">Twitter</span></a></li>
        <li class="header__sns--item"><a href="https://www.tiktok.com/@seed_freedom_official" class="icon-tik" target="_blank"><span class="hd">TIKTOK</span></a></li>
      </ul>
    </div>
    <!--./header__sns-->
    <div class="header__link pc">
      <div class="header__link--item"><a href="./theater/"><span class="u-font-futura">THEATER</span><span class="icon-arrow"></span></a></div>
    </div>
    <!--./header__link-->
  </div>
</header>

<!-- Main show -->
<section>
    <!-- top -->
    <div class="top-show">
        <!-- <img class="top-img" src="http://149.88.95.15:9000/image/lovelive1.jpg" alt=""> -->
        <img class="top-img" src="http://149.88.95.15:9000/image/visual_2.jpg" alt="">
        <div class="top-text">
            <h1>标题</h1>
            <p class="">
                <span class="top-profile">
                    <div class="top-profile"><img class="top-profile-img" src="http://149.88.95.15:9000/image/Liyuu.png" alt=""></div>
                </span>
                <span>name</span>·
                <span>创建日期</span>·
                <span>阅读量</span>
            </p>
        </div>
    </div>
    
    <!-- bottom -->
    <div class="bottom-show">
      <!-- <h1>路由传入的参数{{ route.params.id }}</h1> -->
      <MdPreview :editorId="state.id" :modelValue="state.text" @onGetCatalog="onGetCatalog"/>
    </div>
    <div class="nav-column" :class="{ fixedNav: isFixed }" :style="{ transform: `translateX(${isFixed ? '0' : '-100%'})` }"><MdCatalog :editorId="state.id" :scrollElement="scrollElement" /></div>

</section>

<footer class="footer js-footer js-obs">
  <div class="footer__in">
  <ul class="footer__bnr--list">
    <li class="footer__bnr--item bnr-1"><a href="https://www.gundam.info/" class="ah" target="_blank"><img src="./assets/img/common/bnr/footer_bnr_01.png" alt="GUNDAM.INFO | 公式ガンダム情報ポータルサイト" loading="lazy"></a></li>
    <li class="footer__bnr--item bnr-2"><a href="https://www.youtube.com/c/GUNDAM" class="ah" target="_blank"><img src="./assets/img/common/bnr/footer_bnr_02.png" alt="ガンダムチャンネル" loading="lazy"></a></li>
    <li class="footer__bnr--item bnr-3"><a href="https://www.gundamfc.com/" class="ah" target="_blank"><img src="./assets/img/common/bnr/footer_bnr_03.png" alt="ガンダム初の公式ファンクラブ" loading="lazy"></a></li>
    <li class="footer__bnr--item bnr-4"><a href="https://gundam-navi-app.bn-ent.net/" class="ah" target="_blank"><img src="./assets/img/common/bnr/footer_bnr_04.png" alt="ガンダムナビアプリ" loading="lazy"></a></li>
  </ul>
  <!--./footer__bnrList-->
  <div class="footer__bnr--bottom"><a href="https://www.sunrise-inc.co.jp/" class="ah" target="_blank"><img src="./assets/img/common/bnr/footer_bnr_sunrise.png" alt="サンライズ｜SUNRISE" loading="lazy"></a></div>
  </div>
  <div class="footer__caution">
    <p class="footer__caution--text">
    注意：内容および画像の転載はお断りいたします。<br>お問い合せ先はこちらをご覧ください。
    </p>
    <div class="footer__caution--bottom">
      <p class="footer__caution--copy">© 創通・サンライズ</p>
      <ul class="footer__caution--link">
        <li><a href="https://www.sunrise-inc.co.jp/corporate/faq.php" target="_blank">作品情報について</a></li>
        <li><a href="https://www.bnfw.co.jp/corporate/profile/" target="_blank">会社情報について</a></li>
      </ul>
    </div>
  </div>
</footer>
<!--./footer-->

<!-- Background -->
<div class="fixbg" :id="pageid">  
    <div class="cmn__triangle">
        <div class="cmn__triangle--item -blue -top"></div>
        <div class="cmn__triangle--item -gray -bottom"></div>
    </div>
  </div>
</template>
<script lang="ts" setup>
import { allArticle } from '@/api/api';
import { ref, reactive, onMounted, onUpdated, onUnmounted } from 'vue'


const pageid = ref('top');  
// 定义一个函数来检查 pageid 并添加类  
const checkAndAddClass = () => {
  setTimeout(()=>{
    const elements = document.querySelectorAll('.js-obs') as NodeListOf<HTMLElement>;  
    if (pageid.value === 'top') {
      document.body.classList.add('-loaded');
      elements.forEach((element) => {  
      if (!element.classList.contains('-inview')) {  
        element.classList.add('-inview');  
      }   
    })
  }  
  },0)  
};  
// 在组件挂载后执行该函数  
onMounted(checkAndAddClass);

// Menu options to Appear
function navAniAppear() {  
 // 获取所有的.nav-ani元素  
 const menuItems = document.querySelectorAll('.nav-ani');  
  // let menuTimer: number | null = null;  
  // 设置外层定时器，延迟100ms后执行  
  let menuTimer = window.setTimeout(() => {  
    // 遍历每个元素设置内部定时器
    Array.from(menuItems).forEach((($menuItem, i) => {  
      let menuItemTimer = window.setTimeout(() => {  
        $menuItem.classList.add('is-ani');  
      }, 50 * i);  
    }))
  })

}    
    
// Menu options to Leave
function navAniLeave() {  
  const menuItems = document.querySelectorAll('.nav-ani')
}  
// Menu 
document.addEventListener('DOMContentLoaded', () => {  
  const menuElement = document.querySelector('.js-menu') as HTMLElement;  
  const headerElement = document.querySelector('.js-header') as HTMLElement;  
  const logoElement = document.querySelector('.header__logo') as HTMLElement;  
  
  menuElement.addEventListener('click', () => {  
    menuElement.classList.toggle('is-active');  
  
    if (menuElement.classList.contains('is-active')) {  
      // 打开菜单  
      headerElement.classList.add('is-active');  
      // logoElement.classList.add('is-active');  
      document.body.style.overflow = 'hidden';  
  
      setTimeout(() => {  
        navAniAppear(); // 假设这是你的动画函数  
      }, 100);  
    } else {  
      // 关闭菜单  
      navAniLeave(); // 假设这是你的动画函数  
      headerElement.classList.add('is-close');  
      document.body.style.overflow = '';  
      document.documentElement.style.overflow = '';  
  
      setTimeout(() => {  
        headerElement.classList.remove('is-active');  
        // logoElement.classList.remove('is-active');  
  
        setTimeout(() => {  
          headerElement.classList.remove('is-close');  
          const navAniElements = document.querySelectorAll('.nav-ani') as NodeListOf<HTMLElement>;  
          navAniElements.forEach(el => {  
            el.classList.remove('is-leave');  
            el.classList.remove('is-ani');  
          });  
        }, 500);  
      }, 250);  
    }  
  });  
});

// get id
import { useRoute } from 'vue-router';
const route = useRoute()
// const getId = () => {
//   console.log('Article ID:', route.params.id);
// }  
// getId()

import { MdPreview, MdCatalog } from 'md-editor-v3';
import 'md-editor-v3/lib/preview.css';
import { selArticleById } from '@/api/api'
const state = reactive({
  theme: 'dark',
  text: '',
  id: 'my-editor',
  catalogList: []
});
let id = parseInt(route.params.id,10)
// const text = ref('# Hello Editor');
const showArticle = () => {
    selArticleById(id).then(res=>{
      state.text = res.data.data.articleContent
      console.log(res.data.data.articleContent)
      console.log(state.text)
    })
  }
showArticle() 



const onGetCatalog = (list:any) => {
  state.catalogList = list;
  console.log(state.catalogList)
};
const scrollElement = document.documentElement;


const isFixed = ref(false); // 是否固定导航栏  
    const threshold = 250; // 滚动阈值  
  
    // 处理滚动事件  
    const handleScroll = () => {  
      const scrollTop = window.scrollY || window.pageYOffset;  
      isFixed.value = scrollTop >= threshold;  
    };  
    onMounted(() => {  
      window.addEventListener('scroll', handleScroll);  
    });  
  
    // 组件卸载时移除滚动事件监听器  
    onUnmounted(() => {  
      window.removeEventListener('scroll', handleScroll);  
    });  
</script>

<style scoped>
 @import '../assest/css/common.css';
 @import '../assest/css/articleList.css';
 @import '../assest/css/articleShow.css'
</style>